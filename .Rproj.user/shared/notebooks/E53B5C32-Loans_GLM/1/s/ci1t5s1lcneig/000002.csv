"0","# title: ""Loans_GLM"""
"0","# author: ""Jordi Tarroch"""
"0","# date: ""02/10/2019"""
"0",""
"0","##############"
"0","#LIBRARIES####"
"0","##############"
"0","library(readr)"
"0","library(skimr)# Beautiful Summarize"
"2","Registered S3 method overwritten by 'dplyr':
  method           from
  print.rowwise_df     
"
"2","
Attaching package: â€˜skimrâ€™

"
"2","The following object is masked from â€˜package:statsâ€™:

    filter

"
"0","library(mltools)"
"2","Registered S3 method overwritten by 'data.table':
  method           from
  print.data.table     
"
"0","library(cleandata)"
"0","library(shiny)"
"2","Registered S3 methods overwritten by 'htmltools':
  method               from         
  print.html           tools:rstudio
  print.shiny.tag      tools:rstudio
  print.shiny.tag.list tools:rstudio
"
"0","library(onehot)"
"2","Loading required package: Matrix
"
"0","library(PerformanceAnalytics) # Correlations"
"2","Loading required package: xts
"
"2","Loading required package: zoo
"
"2","
Attaching package: â€˜zooâ€™

"
"2","The following objects are masked from â€˜package:baseâ€™:

    as.Date, as.Date.numeric

"
"2","Registered S3 method overwritten by 'xts':
  method     from
  as.zoo.xts zoo 
"
"2","
Attaching package: â€˜PerformanceAnalyticsâ€™

"
"2","The following object is masked from â€˜package:mltoolsâ€™:

    skewness

"
"2","The following object is masked from â€˜package:graphicsâ€™:

    legend

"
"0","library(corrplot)# Correlations"
"2","corrplot 0.84 loaded
"
"0","library(ggcorrplot)  # Correlations"
"2","Loading required package: ggplot2
"
"0","library('ROCR')"
"2","Loading required package: gplots
"
"2","
Attaching package: â€˜gplotsâ€™

"
"2","The following object is masked from â€˜package:PerformanceAnalyticsâ€™:

    textplot

"
"2","The following object is masked from â€˜package:statsâ€™:

    lowess

"
"0","library(tidyverse)#select_at"
"2","[37mâ”€â”€ [1mAttaching packages[22m â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 1.2.1 â”€â”€[39m
"
"2","[37m[32mâœ”[37m [34mtibble [37m 2.1.3     [32mâœ”[37m [34mdplyr  [37m 0.8.3
[32mâœ”[37m [34mtidyr  [37m 1.0.0     [32mâœ”[37m [34mstringr[37m 1.4.0
[32mâœ”[37m [34mpurrr  [37m 0.3.2     [32mâœ”[37m [34mforcats[37m 0.4.0[39m
"
"2","[37mâ”€â”€ [1mConflicts[22m â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
[31mâœ–[37m [34mtidyr[37m::[32mexpand()[37m     masks [34mMatrix[37m::expand()
[31mâœ–[37m [34mdplyr[37m::[32mfilter()[37m     masks [34mskimr[37m::filter(), [34mstats[37m::filter()
[31mâœ–[37m [34mdplyr[37m::[32mfirst()[37m      masks [34mxts[37m::first()
[31mâœ–[37m [34mdplyr[37m::[32mlag()[37m        masks [34mstats[37m::lag()
[31mâœ–[37m [34mdplyr[37m::[32mlast()[37m       masks [34mxts[37m::last()
[31mâœ–[37m [34mtidyr[37m::[32mpack()[37m       masks [34mMatrix[37m::pack()
[31mâœ–[37m [34mtidyr[37m::[32mreplace_na()[37m masks [34mmltools[37m::replace_na()
[31mâœ–[37m [34mtidyr[37m::[32munpack()[37m     masks [34mMatrix[37m::unpack()[39m
"
"0","##############"
"0","# GET DATA####"
"0","##############"
"0","path <- 'loan_filtered.csv'"
"0","raw_data <-  read_csv(path)"
"2","Parsed with column specification:
cols(
  annual_inc = [32mcol_double()[39m,
  emp_length = [31mcol_character()[39m,
  grade = [31mcol_character()[39m,
  home_ownership = [31mcol_character()[39m,
  int_rate = [31mcol_character()[39m,
  loan_amnt = [32mcol_double()[39m,
  loan_status = [31mcol_character()[39m,
  purpose = [31mcol_character()[39m,
  term = [31mcol_character()[39m
)
"
"0","#####################"
"0","# DATA WRANGLING ####"
"0","#####################"
"0","dim(raw_data)"
"1","[1]"
"1"," 887383"
"1","      9"
"1","
"
"0","skim(raw_data) # Summarise"
"1","Skim summary statistics
"
"1"," n obs:"
"1"," "
"1","887383"
"1"," "
"1","
"
"1"," n variables:"
"1"," "
"1","9"
"1"," "
"1","
"
"1","
"
"1","â”€â”€ Variable type:character â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
"1","
"
"1",""
"1","       variable"
"1"," missing"
"1"," complete"
"1","      n"
"1"," min"
"1"," max"
"1"," empty"
"1"," n_unique"
"1","
"
"1","     emp_length"
"1","       1"
"1","   887382"
"1"," 887383"
"1","   3"
"1","   9"
"1","     0"
"1","       12"
"1","
"
"1","          grade"
"1","       1"
"1","   887382"
"1"," 887383"
"1","   1"
"1","   1"
"1","     0"
"1","        7"
"1","
"
"1"," home_ownership"
"1","       1"
"1","   887382"
"1"," 887383"
"1","   3"
"1","   8"
"1","     0"
"1","        6"
"1","
"
"1","       int_rate"
"1","       1"
"1","   887382"
"1"," 887383"
"1","   5"
"1","   6"
"1","     0"
"1","      542"
"1","
"
"1","    loan_status"
"1","       1"
"1","   887382"
"1"," 887383"
"1","   6"
"1","  51"
"1","     0"
"1","       10"
"1","
"
"1","        purpose"
"1","       1"
"1","   887382"
"1"," 887383"
"1","   3"
"1","  18"
"1","     0"
"1","       14"
"1","
"
"1","           term"
"1","       1"
"1","   887382"
"1"," 887383"
"1","   9"
"1","   9"
"1","     0"
"1","        2"
"1","
"
"1","
"
"1","â”€â”€ Variable type:numeric â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
"1","
"
"1",""
"1","   variable"
"1"," missing"
"1"," complete"
"1","      n"
"1","     mean"
"1","       sd"
"1","  p0"
"1","   p25"
"1","   p50"
"1","   p75"
"1","    p100"
"1","
"
"1"," annual_inc"
"1","       5"
"1","   887378"
"1"," 887383"
"1"," 75027.61"
"1"," 64698.23"
"1","   0"
"1"," 45000"
"1"," 65000"
"1"," 90000"
"1"," 9500000"
"1","
"
"1","  loan_amnt"
"1","       1"
"1","   887382"
"1"," 887383"
"1"," 14755.28"
"1","  8435.46"
"1"," 500"
"1","  8000"
"1"," 13000"
"1"," 20000"
"1","   35000"
"1","
"
"1",""
"1","     hist"
"1","
"
"1"," â–‡â–â–â–â–â–â–â–"
"1","
"
"1"," â–ƒâ–‡â–‡â–†â–…â–ƒâ–‚â–‚"
"1","
"
"0","# CHECK DUPLICATED DATA: no duplicated data to delete."
"0","# CHECK NA's: "
"0","raw_data<-na.omit(raw_data)"
"0","summary(raw_data$emp_length)"
"1","   Length "
"1","    Class "
"1","     Mode "
"1","
"
"1","   887378 "
"1","character "
"1","character "
"1","
"
"0","# ORDINAL ENCODING"
"0","levels <- c('n/a', '< 1 year', '1 year', '2 years', '3 years', '4 years', '5 years', '6 years', '7 years', '8 years', '9 years', '10+ years')"
"0","raw_data$emp_length = factor(raw_data$emp_length, order = TRUE , levels)"
"0","x <- as.data.frame(raw_data$emp_length)"
"0",""
"0","raw_data$emp_length <- encode_ordinal( x, levels, none='', out.int=FALSE,"
"0","               full_print=TRUE)"
"1",""
"1"," raw_data$emp_length"
"1","
"
"1"," 10+ years:291570   "
"1","
"
"1"," 2 years  : 78870   "
"1","
"
"1"," < 1 year : 70602   "
"1","
"
"1"," 3 years  : 70026   "
"1","
"
"1"," 1 year   : 57095   "
"1","
"
"1"," 5 years  : 55704   "
"1","
"
"1"," (Other)  :263511   "
"1","
"
"1","coded 1 cols 12 levels 
"
"1",""
"1"," raw_data$emp_length"
"1","
"
"1"," 12     :291570     "
"1","
"
"1"," 4      : 78870     "
"1","
"
"1"," 2      : 70602     "
"1","
"
"1"," 5      : 70026     "
"1","
"
"1"," 3      : 57095     "
"1","
"
"1"," 7      : 55704     "
"1","
"
"1"," (Other):263511     "
"1","
"
"0","raw_data$emp_length <- as.numeric(unlist(raw_data$emp_length))"
"0",""
"0",""
"0","levels <- c('A', 'B', 'C', 'D', 'E', 'F', 'G')"
"0","raw_data$grade = factor(raw_data$grade, order = TRUE , levels)"
"0","x <- as.data.frame(raw_data$grade)"
"0","raw_data$grade <- encode_ordinal( x, levels, none='', out.int=FALSE,"
"0","                                       full_print=TRUE)"
"1",""
"1"," raw_data$grade"
"1","
"
"1"," A:148199      "
"1","
"
"1"," B:254535      "
"1","
"
"1"," C:245860      "
"1","
"
"1"," D:139543      "
"1","
"
"1"," E: 70705      "
"1","
"
"1"," F: 23047      "
"1","
"
"1"," G:  5489      "
"1","
"
"1","coded 1 cols 7 levels 
"
"1",""
"1"," raw_data$grade"
"1","
"
"1"," 1:148199      "
"1","
"
"1"," 2:254535      "
"1","
"
"1"," 3:245860      "
"1","
"
"1"," 4:139543      "
"1","
"
"1"," 5: 70705      "
"1","
"
"1"," 6: 23047      "
"1","
"
"1"," 7:  5489      "
"1","
"
"0","raw_data$grade <- as.numeric(unlist(raw_data$grade))"
"0",""
"0","# NOMINAL ENCODING - ONEHOT ENCODING"
"0",""
"0","# https://github.com/Zelazny7/onehot"
"0","home_ownership <- as.data.frame(raw_data$home_ownership)"
"0","encoder <- onehot(home_ownership, max_levels = 15, add_NA_factors = FALSE)"
"0","home_ownership_onehot<- predict(encoder, home_ownership, stringsAsFactors=TRUE)"
"0","head(home_ownership_onehot,10)"
"1","     "
"1"," raw_data$home_ownership_ANY"
"1"," raw_data$home_ownership_MORTGAGE"
"1","
 [1,]"
"1","                           0"
"1","                                0"
"1","
 [2,]"
"1","                           0"
"1","                                0"
"1","
 [3,]"
"1","                           0"
"1","                                0"
"1","
 [4,]"
"1","                           0"
"1","                                0"
"1","
 [5,]"
"1","                           0"
"1","                                0"
"1","
 [6,]"
"1","                           0"
"1","                                0"
"1","
 [7,]"
"1","                           0"
"1","                                0"
"1","
 [8,]"
"1","                           0"
"1","                                0"
"1","
 [9,]"
"1","                           0"
"1","                                0"
"1","
[10,]"
"1","                           0"
"1","                                0"
"1","
"
"1","     "
"1"," raw_data$home_ownership_NONE"
"1"," raw_data$home_ownership_OTHER"
"1","
 [1,]"
"1","                            0"
"1","                             0"
"1","
 [2,]"
"1","                            0"
"1","                             0"
"1","
 [3,]"
"1","                            0"
"1","                             0"
"1","
 [4,]"
"1","                            0"
"1","                             0"
"1","
 [5,]"
"1","                            0"
"1","                             0"
"1","
 [6,]"
"1","                            0"
"1","                             0"
"1","
 [7,]"
"1","                            0"
"1","                             0"
"1","
 [8,]"
"1","                            0"
"1","                             0"
"1","
 [9,]"
"1","                            0"
"1","                             0"
"1","
[10,]"
"1","                            0"
"1","                             0"
"1","
"
"1","     "
"1"," raw_data$home_ownership_OWN"
"1"," raw_data$home_ownership_RENT"
"1","
 [1,]"
"1","                           0"
"1","                            1"
"1","
 [2,]"
"1","                           0"
"1","                            1"
"1","
 [3,]"
"1","                           0"
"1","                            1"
"1","
 [4,]"
"1","                           0"
"1","                            1"
"1","
 [5,]"
"1","                           0"
"1","                            1"
"1","
 [6,]"
"1","                           0"
"1","                            1"
"1","
 [7,]"
"1","                           0"
"1","                            1"
"1","
 [8,]"
"1","                           0"
"1","                            1"
"1","
 [9,]"
"1","                           1"
"1","                            0"
"1","
[10,]"
"1","                           0"
"1","                            1"
"1","
"
"0","raw_data <- cbind(raw_data, home_ownership_onehot)"
"0",""
"0","purpose <- as.data.frame(raw_data$purpose)"
"0","encoder <- onehot(purpose, max_levels = 15, add_NA_factors = FALSE)"
"0","purpose_onehot<- predict(encoder, purpose, stringsAsFactors=TRUE)"
"0","head(purpose_onehot,10)"
"1","     "
"1"," raw_data$purpose_car"
"1"," raw_data$purpose_credit_card"
"1"," raw_data$purpose_debt_consolidation"
"1","
 [1,]"
"1","                    0"
"1","                            1"
"1","                                   0"
"1","
 [2,]"
"1","                    1"
"1","                            0"
"1","                                   0"
"1","
 [3,]"
"1","                    0"
"1","                            0"
"1","                                   0"
"1","
 [4,]"
"1","                    0"
"1","                            0"
"1","                                   0"
"1","
 [5,]"
"1","                    0"
"1","                            0"
"1","                                   0"
"1","
 [6,]"
"1","                    0"
"1","                            0"
"1","                                   0"
"1","
 [7,]"
"1","                    0"
"1","                            0"
"1","                                   1"
"1","
 [8,]"
"1","                    1"
"1","                            0"
"1","                                   0"
"1","
 [9,]"
"1","                    0"
"1","                            0"
"1","                                   0"
"1","
[10,]"
"1","                    0"
"1","                            0"
"1","                                   0"
"1","
"
"1","     "
"1"," raw_data$purpose_educational"
"1"," raw_data$purpose_home_improvement"
"1"," raw_data$purpose_house"
"1","
 [1,]"
"1","                            0"
"1","                                 0"
"1","                      0"
"1","
 [2,]"
"1","                            0"
"1","                                 0"
"1","                      0"
"1","
 [3,]"
"1","                            0"
"1","                                 0"
"1","                      0"
"1","
 [4,]"
"1","                            0"
"1","                                 0"
"1","                      0"
"1","
 [5,]"
"1","                            0"
"1","                                 0"
"1","                      0"
"1","
 [6,]"
"1","                            0"
"1","                                 0"
"1","                      0"
"1","
 [7,]"
"1","                            0"
"1","                                 0"
"1","                      0"
"1","
 [8,]"
"1","                            0"
"1","                                 0"
"1","                      0"
"1","
 [9,]"
"1","                            0"
"1","                                 0"
"1","                      0"
"1","
[10,]"
"1","                            0"
"1","                                 0"
"1","                      0"
"1","
"
"1","     "
"1"," raw_data$purpose_major_purchase"
"1"," raw_data$purpose_medical"
"1"," raw_data$purpose_moving"
"1","
 [1,]"
"1","                               0"
"1","                        0"
"1","                       0"
"1","
 [2,]"
"1","                               0"
"1","                        0"
"1","                       0"
"1","
 [3,]"
"1","                               0"
"1","                        0"
"1","                       0"
"1","
 [4,]"
"1","                               0"
"1","                        0"
"1","                       0"
"1","
 [5,]"
"1","                               0"
"1","                        0"
"1","                       0"
"1","
 [6,]"
"1","                               0"
"1","                        0"
"1","                       0"
"1","
 [7,]"
"1","                               0"
"1","                        0"
"1","                       0"
"1","
 [8,]"
"1","                               0"
"1","                        0"
"1","                       0"
"1","
 [9,]"
"1","                               0"
"1","                        0"
"1","                       0"
"1","
[10,]"
"1","                               0"
"1","                        0"
"1","                       0"
"1","
"
"1","     "
"1"," raw_data$purpose_other"
"1"," raw_data$purpose_renewable_energy"
"1","
 [1,]"
"1","                      0"
"1","                                 0"
"1","
 [2,]"
"1","                      0"
"1","                                 0"
"1","
 [3,]"
"1","                      0"
"1","                                 0"
"1","
 [4,]"
"1","                      1"
"1","                                 0"
"1","
 [5,]"
"1","                      1"
"1","                                 0"
"1","
 [6,]"
"1","                      0"
"1","                                 0"
"1","
 [7,]"
"1","                      0"
"1","                                 0"
"1","
 [8,]"
"1","                      0"
"1","                                 0"
"1","
 [9,]"
"1","                      0"
"1","                                 0"
"1","
[10,]"
"1","                      1"
"1","                                 0"
"1","
"
"1","     "
"1"," raw_data$purpose_small_business"
"1"," raw_data$purpose_vacation"
"1"," raw_data$purpose_wedding"
"1","
 [1,]"
"1","                               0"
"1","                         0"
"1","                        0"
"1","
 [2,]"
"1","                               0"
"1","                         0"
"1","                        0"
"1","
 [3,]"
"1","                               1"
"1","                         0"
"1","                        0"
"1","
 [4,]"
"1","                               0"
"1","                         0"
"1","                        0"
"1","
 [5,]"
"1","                               0"
"1","                         0"
"1","                        0"
"1","
 [6,]"
"1","                               0"
"1","                         0"
"1","                        1"
"1","
 [7,]"
"1","                               0"
"1","                         0"
"1","                        0"
"1","
 [8,]"
"1","                               0"
"1","                         0"
"1","                        0"
"1","
 [9,]"
"1","                               1"
"1","                         0"
"1","                        0"
"1","
[10,]"
"1","                               0"
"1","                         0"
"1","                        0"
"1","
"
"0","raw_data <- cbind(raw_data, purpose_onehot)"
"0",""
"0","#DICOTOMIC ENCODING"
"0","default <- (raw_data$loan_status == ""Default"")*1"
"0","raw_data$default <- default"
"0",""
"0","raw_data$term = factor(raw_data$term)"
"0","short_1_long_term_0 <- (raw_data$term == ""36 months"")*1"
"0","raw_data$short_1_long_term_0 <- short_1_long_term_0"
"0",""
"0","#df<- subset(raw_data, select=-c(4,7,8,9))"
"0","df<- subset(raw_data, select=-c(4,7,8,9,10,12,13,16,17,18,20,21,22,23,24,25,26,28,29))"
"0","names(df)"
"1"," [1]"
"1"," ""annual_inc""                      "
"1"," ""emp_length""                      "
"1","
"
"1"," [3]"
"1"," ""grade""                           "
"1"," ""int_rate""                        "
"1","
"
"1"," [5]"
"1"," ""loan_amnt""                       "
"1"," ""raw_data$home_ownership_MORTGAGE"""
"1","
"
"1"," [7]"
"1"," ""raw_data$home_ownership_OWN""     "
"1"," ""raw_data$home_ownership_RENT""    "
"1","
"
"1"," [9]"
"1"," ""raw_data$purpose_educational""    "
"1"," ""raw_data$purpose_small_business"" "
"1","
"
"1","[11]"
"1"," ""default""                         "
"1"," ""short_1_long_term_0""             "
"1","
"
"0","df$int_rate <- as.double(gsub('%','',df$int_rate))/100"
"0",""
"0","# Rename a column in R"
"0","names(df)"
"1"," [1]"
"1"," ""annual_inc""                      "
"1"," ""emp_length""                      "
"1","
"
"1"," [3]"
"1"," ""grade""                           "
"1"," ""int_rate""                        "
"1","
"
"1"," [5]"
"1"," ""loan_amnt""                       "
"1"," ""raw_data$home_ownership_MORTGAGE"""
"1","
"
"1"," [7]"
"1"," ""raw_data$home_ownership_OWN""     "
"1"," ""raw_data$home_ownership_RENT""    "
"1","
"
"1"," [9]"
"1"," ""raw_data$purpose_educational""    "
"1"," ""raw_data$purpose_small_business"" "
"1","
"
"1","[11]"
"1"," ""default""                         "
"1"," ""short_1_long_term_0""             "
"1","
"
"0","colnames(df)[colnames(df)==""raw_data$home_ownership_OWN""] <- ""home_owner"""
"0","colnames(df)[colnames(df)==""raw_data$home_ownership_MORTGAGE""] <- ""home_mortgage"""
"0","colnames(df)[colnames(df)==""raw_data$home_ownership_RENT""] <- ""home_rent"""
"0","colnames(df)[colnames(df)==""emp_length""] <- ""employment_length"""
"0","colnames(df)[colnames(df)==""raw_data$purpose_educational""] <- ""purposeeducational"""
"0","colnames(df)[colnames(df)==""raw_data$purpose_small_business""] <- ""purposesmallbusiness"""
"0",""
"0","# skim(df)"
